@ITEM_BOUGHT_31

VARSET LOCAL, 0

REPEAT CHARANUM
	SIF COUNT == MASTER
		CONTINUE
		
	SIF NO:COUNT > 64
		LOCAL:(NO:COUNT - 64) = 1
REND

IF ITEM:31
	DRAWLINE
	PRINTFORML %ITEMNAME:31%を誰に使用しますか？
	
	REPEAT CHARANUM
		SIF COUNT == MASTER
			CONTINUE
			
		IF LOCAL:(NO:COUNT)
			PRINTFORML [---] - %NAME:COUNT% ×既に難調教キャラが存在します
			CONTINUE
		ENDIF
			
		CALL TEST_GLOOM_FALLEN, COUNT
		IF RESULT == 0
			PRINTFORML [---] - %NAME:COUNT% ×使用できません
			CONTINUE
		ENDIF
		
		CALL JUDGE_GLOOM_FALLEN, COUNT
		IF RESULT == 0
			PRINTFORML [---] - %NAME:COUNT% ×身体が耐えられません
			CONTINUE
		ENDIF
		
		PRINTFORML [{COUNT,3,RIGHT}] - %NAME:COUNT% ○使用できます
	REND
	
	DRAWLINE
	PRINTFORML [100] - 戻る(払い戻しします)
	DRAWLINE

$INPUT_LOOP_1
	INPUT
	
	V:32 = RESULT
	
	IF V:32 == 100
		ITEM:31 = 0
		MONEY += ITEMPRICE:31
		PRINTW 払い戻ししました
		RETURN 0
	ENDIF
	
	IF LOCAL:(NO:(V:32))
		CLEARLINE 1
		REUSELASTLINE 正しい値を入力してください
		GOTO INPUT_LOOP_1
	ENDIF
	
	CALL TEST_GLOOM_FALLEN, V:32
	IF RESULT == 0
		CLEARLINE 1
		REUSELASTLINE 正しい値を入力してください
		GOTO INPUT_LOOP_1
	ENDIF
	
	CALL JUDGE_GLOOM_FALLEN, V:32
	IF RESULT == 0
		CLEARLINE 1
		REUSELASTLINE 正しい値を入力してください
		GOTO INPUT_LOOP_1
	ENDIF
	
	CALL DO_GLOOM_FALLEN, V:32
	ITEM:31 = 0
	PRINTL 調教難化を行いました
	
	DRAWLINE
	
ENDIF