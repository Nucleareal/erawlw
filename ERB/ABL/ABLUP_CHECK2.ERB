;ARG->実行する番号(-1でチェックのみ, -2で表示あり), ARG:1->チェックする奴隷

;======================v ここ
@CHECK_ABLUP_AVAILABLE_2, ARG, ARG:1

IF ARG:1 == 0
	ARG:1 = TARGET
ENDIF

VARSET LOCAL, 0

;TARGETを避難
LOCAL:0 = TARGET
TARGET = ARG:1

;既にLv5
;======v ここ
IF ABL:2 >= 5
	SIF ARG == -2
		PRINTW 既にMAXです
	RETURN 0
ENDIF

;LOCAL:1 条件1
;LOCAL:2
;LOCAL:3
;LOCAL:4

;結果
;LOCAL:998

;臆病をみて、あるなら1
LOCAL:100 = TALENT:10

;==============v ここ
SELECTCASE ABL:2
	CASE 0
		LOCAL:50 = 1
	CASE 1
		LOCAL:50 = 25
	CASE 2
		LOCAL:50 = 200
	CASE 3
		LOCAL:50 = 3000
	CASE 4
		LOCAL:50 = 20000
ENDSELECT

;[一線超えない]は技術習得に関係ないと思われるので省く
;IF TALENT:27
;==================v ここ
;	SELECTCASE ABL:2
;		CASE 3
;			TIMES LOCAL:50 , 2.00
;		CASE 4
;			TIMES LOCAL:50 , 3.00
;	ENDSELECT
;ENDIF

;性質チェック

;Lv4 -> Lv5 特になし
;IF ABL:2 == 4
;	;[快感に素直]なら無視
;	IF TALENT:70 == 0
;		SIF ARG == -2
;			PRINTFORML %EXPNAME:50%あり、かつ
;		IF EXP:50 == 0
;			LOCAL:1 |= 2
;		ENDIF
;	ENDIF
;ENDIF

;習得の珠で上げる
SIF LOCAL:50 > 0 && JUEL:7 < LOCAL:50
	LOCAL:1 |= 1

;チェックのみなら返却
IF ARG == -1
	TARGET = LOCAL:0
	
	SIF LOCAL:1 == 0
		RETURN 1
		
	RETURN 0
ENDIF

IF ARG == -2
	;表記1
	
	IF LOCAL:50 > 0
		CALL PRINT_UPGRADE_AVAILABLE_PREFIX, LOCAL:1, 0
		CALL PRINT_UPGRADE_AVAILABLE_JUEL, 7, LOCAL:50
		CALL PRINT_UPGRADE_AVAILABLE_STATUS, LOCAL:1
		CALL PRINT_UPGRADE_AVAILABLE_POSTFIX, LOCAL:1
	ENDIF
	
	PRINTL [10] - やめる
ENDIF

INPUT
SIF RESULT == 10
	RETURN 0

IF RESULT < 0 || RESULT > 0
	RESTART
ENDIF

IF (LOCAL:1 && RESULT == 0)
	PRINTL 条件を満たしていません
	RESTART
ENDIF

;===v ここ
ABL:2 += 1

;===============================v ここ===v ここ
PRINTFORMW %CALLNAME%の%ABLNAME:2%が{ABL:2}になりました

SELECTCASE RESULT
	CASE 0
;============v ここ
		JUEL:7 -= LOCAL:50
ENDSELECT

TARGET = LOCAL:0

;=========================================v ここ=v ここ
CALL DISPLAY_KOJO_MESSAGE_PALAMCNG_SLAVE, 2, ABL:2
CALL DISPLAY_KOJO_MESSAGE_PALAMCNG_ASSI , 2, ABL:2